{% extends "base.html" %}

{% block title %}更新信息 - {% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        <div class="content task">
            {% if item %}
            <div class="avatar-area">
                <div class="avatar" style="background: url({% if item.user.userprofile.openid %}{{ item.user.userprofile.avatar }}{% else %}{% if item.user.userprofile.avatar %}/s/{{ item.user.userprofile.avatar }}{% else %}/s/avatar/n.png{% endif %}{% endif %}) no-repeat;background-size: cover;background-position: center;"><img src="{% if item.user.userprofile.openid %}{{ item.user.userprofile.avatar }}{% else %}{% if item.user.userprofile.avatar %}/s/{{ item.user.userprofile.avatar }}{% else %}/s/avatar/n.png{% endif %}{% endif %}" /></div>
            </div>
            <div class="task-head">
                <div class="task-info">
                    <span class="task-info-right"><a class="task-created">{% with item.itemcontent_set.all|first as itemcontent %}{{ itemcontent.create|date:'Y-m-d H:i:s'}}{% endwith %}</a></span>
                    
                    <span class="task-info-left"><a class="username" href="/{{ item.user.username }}/"><span class="username">{{ item.user.username }}</span></a>
                    <br />
                    <span class="userinfo">{{ item.user.userprofile.info }}</span></span>
                </div>
                <h3 class="task-title"><a href="/i/{{ item.id }}/">{{ item.title }}</a></h3>
            </div>
            <div class="line"><!--<label>详情：</label>-->
            {% for itemcontent in item.itemcontent_set.all %}
                <div class="itemcontent">
                    {% if forloop.first %}
                    <pre class="description">{{ item.firstcontent }}</pre>
                    {% else %}
                    <p class="updated">{{ itemcontent.create|date:'Y-m-d H:i:s' }}</p>
                    <pre class="description">{{ itemcontent.content }}</pre>
                    {% endif %}
                    {% for attachmentfile in item.attachmentfiles %}
                        {% if attachmentfile.contenttype == 'image' %}
                        <p><img src="/s/{{ attachmentfile.file }}" title="{{ attachmentfile.title }}" /></p>{% elif attachmentfile.contenttype == 'audio' %}
                        <p><audio controls>
                            <source src="/s/{{ attachmentfile.file }}" type="audio/ogg">
                            <a href="/s/{{ attachmentfile.file }}"><span style="font-style: italic;">(附件)</span> {{ attachmentfile.title }}</a>
                        </audio></p>
                        {% else %}
                        <p><a href="/s/{{ attachmentfile.file }}"><span style="font-style: italic;">(附件)</span> {{ attachmentfile.title }}</a></p>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}
            <h3>更新信息</h3>
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <p class="description"><textarea name="content">{% if form.content.value %}{{ form.content.value }}{% else %}{{ item.content }}{% endif %}</textarea></p>
                <!--<p>附件：<input name="file" type="file" />
                <br />
                (小于2MB有效)</p>-->
                <p><a href="/i/{{ item.id }}/">取消</a> <input type="submit" value="添加更新" /></p>
            </form>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
{% block footer %}
<script type="text/javascript">
$(document).ready(function(){
    $("form").submit(function(){
        $(".submit").attr("disabled", true);
    });
});
</script>
{% endblock %}