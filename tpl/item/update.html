{% extends "base.html" %}
{% load i18n %}

{% block title %}更新信息 - {% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        <div class="content update">
            {% if item %}
            <div class="avatar-area">
                <div class="avatar" style="background: url({% if item.user.userprofile.openid %}{{ item.user.userprofile.avatar }}{% else %}{% if item.user.userprofile.avatar %}/s/{{ item.user.userprofile.avatar }}{% else %}/s/avatar/n.png{% endif %}{% endif %}) no-repeat;background-size: cover;background-position: center;"><img src="{% if item.user.userprofile.openid %}{{ item.user.userprofile.avatar }}{% else %}{% if item.user.userprofile.avatar %}/s/{{ item.user.userprofile.avatar }}{% else %}/s/avatar/n.png{% endif %}{% endif %}" /></div>
            </div>
            <div class="item-head">
                <div class="item-info">
                    <span class="item-info-right"><a class="item-created">{% with item.itemcontent_set.all|first as itemcontent %}{{ itemcontent.create|date:'Y-m-d H:i:s'}}{% endwith %}</a></span>
                    
                    <span class="item-info-left"><a class="username" href="/{{ item.user.username }}/"><span class="username">{{ item.user.username }}</span></a>
                    
                    <span class="userinfo">{{ item.user.userprofile.info }}</span></span>
                </div>
                <h3 class="item-title"><a href="/i/{{ item.id }}/">{{ item.title }}</a></h3>
            </div>
            <div class="line">
            {% for itemcontent in item.itemcontent_set.all %}
                <div class="itemcontent">
                    {% if forloop.first %}
                    <div class="itemcontent-content"><pre>{{ item.firstcontent }}</pre></div>
                    {% else %}
                    <p class="updated">{{ itemcontent.create|date:'Y-m-d H:i:s' }}</p>
                    <div class="itemcontent-content"><pre>{{ itemcontent.content }}</pre></div>
                    {% endif %}
                    {% for attachmentfile in itemcontent.contentattachment_set.all %}
                        {% if 'svg' in attachmentfile.contenttype %}
                        {{ attachmentfile.content|safe }}
                        {% elif 'image' in attachmentfile.contenttype %}
                        <p><img src="/s/{{ attachmentfile.file }}" title="{{ attachmentfile.title }}" /></p>
                        {% elif 'audio' in attachmentfile.contenttype %}
                        <p><audio controls>
                            <source src="/s/{{ attachmentfile.file }}" type="audio/ogg">
                            <a href="/s/{{ attachmentfile.file }}"><span style="font-style: italic;">(附件)</span> {{ attachmentfile.title }}</a>
                        </audio></p>
                        {% else %}
                        <p><a href="/s/{{ attachmentfile.file }}"><span style="font-style: italic;">(附件)</span> {{ attachmentfile.title }}</a></p>
                        {% endif %}
                    {% endfor %}
                </div>
            {% endfor %}
            <h3 id="update-form">更新信息</h3>
            <form class="itemform" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <p class="description"><textarea name="content">{% if form.content.value %}{{ form.content.value }}{% else %}{{ item.content }}{% endif %}</textarea></p>
                <!--<p>附件：
                <br />
                <input class="file" name="file" type="file" />
                <br />
                (小于2MB有效)</p>-->
                <p><input class="submit" type="submit" value="更新信息" /></p>
                <p class="cancel-btn"><a href="/i/{{ item.id }}/">取消</a></p>
            </form>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
{% block footer %}
<script type="text/javascript">
$(document).ready(function(){
    $("form").submit(function(){
        $(".submit").attr("disabled", true);
    });
});
</script>
{% endblock %}
